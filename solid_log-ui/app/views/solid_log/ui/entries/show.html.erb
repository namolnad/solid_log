<div class="entry-detail">
  <div class="page-header">
    <h1>Log Entry Details</h1>
    <div class="page-actions">
      <%= link_to "← Back to Stream", streams_path, class: "btn btn-secondary" %>
    </div>
  </div>

  <div class="entry-detail-content">
    <div class="card">
      <div class="card-header">
        <h2>Metadata</h2>
      </div>
      <div class="card-body">
        <dl class="metadata-list">
          <dt>Timestamp</dt>
          <dd><%= @entry.created_at.iso8601 %> (<%= time_ago_in_words(@entry.created_at) %> ago)</dd>

          <dt>Level</dt>
          <dd>
            <%= level_badge(@entry.level) %>
            <%= link_to "Filter by #{@entry.level} →", streams_path(filters: { levels: [@entry.level] }), class: "metadata-link" %>
          </dd>

          <% if @entry.app.present? %>
            <dt>Application</dt>
            <dd>
              <%= @entry.app %>
              <%= link_to "Filter by app →", streams_path(filters: { app: [@entry.app] }), class: "metadata-link" %>
            </dd>
          <% end %>

          <% if @entry.env.present? %>
            <dt>Environment</dt>
            <dd>
              <%= @entry.env %>
              <%= link_to "Filter by env →", streams_path(filters: { env: [@entry.env] }), class: "metadata-link" %>
            </dd>
          <% end %>

          <% if @entry.request_id.present? %>
            <dt>Request ID</dt>
            <dd>
              <%= @entry.request_id %>
              <%= link_to "View timeline →", request_timeline_path(@entry.request_id), class: "metadata-link" %>
              <%= link_to "Filter →", streams_path(filters: { request_id: @entry.request_id }), class: "metadata-link" %>
            </dd>
          <% end %>

          <% if @entry.job_id.present? %>
            <dt>Job ID</dt>
            <dd>
              <%= @entry.job_id %>
              <%= link_to "View timeline →", job_timeline_path(@entry.job_id), class: "metadata-link" %>
              <%= link_to "Filter →", streams_path(filters: { job_id: @entry.job_id }), class: "metadata-link" %>
            </dd>
          <% end %>

          <% if @entry.controller.present? %>
            <dt>Controller</dt>
            <dd>
              <%= @entry.controller %>#<%= @entry.action %>
              <%= link_to "Filter by controller →", streams_path(filters: { controller: [@entry.controller] }), class: "metadata-link" %>
              <% if @entry.action.present? %>
                <%= link_to "Filter by action →", streams_path(filters: { action: [@entry.action] }), class: "metadata-link" %>
              <% end %>
            </dd>
          <% end %>

          <% if @entry.path.present? %>
            <dt>HTTP Request</dt>
            <dd>
              <%= @entry.method %> <%= @entry.path %>
              <%= link_to "Filter by path →", streams_path(filters: { path: [@entry.path] }), class: "metadata-link" %>
              <% if @entry.method.present? %>
                <%= link_to "Filter by method →", streams_path(filters: { method: [@entry.method] }), class: "metadata-link" %>
              <% end %>
            </dd>
          <% end %>

          <% if @entry.status_code.present? %>
            <dt>Status Code</dt>
            <dd>
              <%= http_status_badge(@entry.status_code) %>
              <%= link_to "Filter by status →", streams_path(filters: { status_code: [@entry.status_code.to_s] }), class: "metadata-link" %>
            </dd>
          <% end %>

          <% if @entry.duration.present? %>
            <dt>Duration</dt>
            <dd><%= format_duration(@entry.duration) %></dd>
          <% end %>
        </dl>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h2>Message</h2>
      </div>
      <div class="card-body">
        <pre class="log-message-full"><%= @entry.message %></pre>
      </div>
    </div>

    <% if @entry.extra_fields.present? && @entry.extra_fields != "{}" %>
      <div class="card">
        <div class="card-header">
          <h2>Additional Fields</h2>
        </div>
        <div class="card-body">
          <pre class="json-display"><%= pretty_json(@entry.extra_fields) %></pre>
        </div>
      </div>
    <% end %>

    <% if @correlated_entries&.any? %>
      <div class="card">
        <div class="card-header">
          <h2>Correlated Log Entries (<%= @correlated_entries.size %>)</h2>
        </div>
        <div class="card-body">
          <div class="log-stream">
            <% @correlated_entries.each do |correlated_entry| %>
              <%= render "solid_log/ui/streams/log_row", entry: correlated_entry %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
